<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üéÆ Pok√©Word - Ch·ªçn nhi·ªám v·ª•</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #3b4cca, #ffcc00);
      color: #fff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      text-align: center;
      background-color: rgba(0, 0, 0, 0.4);
      padding: 30px;
      border-radius: 16px;
      width: 90%;
      max-width: 440px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.5);
    }

    h2 {
      font-size: 30px;
      margin-bottom: 12px;
      text-shadow: 2px 2px 6px #000;
    }

    p {
      font-size: 16px;
      margin-bottom: 20px;
    }

    #exercise-buttons {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-top: 12px;
    }

    #exercise-buttons button {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 12px;
      padding: 14px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 10px;
      border: none;
      background: linear-gradient(to right, #ffcc00, #f6c23e);
      color: #2e2e2e;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      transition: transform 0.2s, background-color 0.3s;
    }

    #exercise-buttons button:hover {
      transform: scale(1.05);
      background: linear-gradient(to right, #f4b619, #ffdb4d);
    }

    #exercise-buttons button img {
      height: 48px;
      width: 48px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üéØ Ch·ªçn nhi·ªám v·ª• Pok√©Word</h2>
    <p>T·ª´ v·ª±ng b·∫°n ƒëang h·ªçc: <span id="wordList"></span></p>

    
    <div style="font-weight:bold; font-size:18px; color:#ffeb3b; text-shadow:1px 1px 2px #000; text-align:left;">
      üìå H·ªåC T·ª™ TR√äN XU·ªêNG D∆Ø·ªöI THEO TH·ª® T·ª∞, ƒê·ª¶ C√ÅC PH·∫¶N. N·∫æU NHI·ªÄU H∆†N 8 T·ª™ V·ª∞NG TH√å CH·ªà C·∫¶N H·ªåC 01 D·∫†NG ·ªû M·ªñI PH·∫¶N C≈®NG ƒê∆Ø·ª¢C
    </div>

    <div id="exercise-buttons">
      <button onclick="startExercise('voca.html')">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/65.png" alt="Alakazam">
        Vocabulary - T·ª´ v·ª±ng
      </button>

      <button onclick="startExerciseWithCheck('image', 'image.html')">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/235.png" alt="Smeargle">
        Image - H√¨nh ·∫£nh
      </button>

      <button onclick="startExerciseWithCheck('game', 'game.html')">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/25.png" alt="Pikachu">
        Game - Tr√≤ ch∆°i
      </button>

      <button onclick="startExerciseWithCheck('listening', 'listening.html')">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/39.png" alt="Jigglypuff">
        Listening - Nghe
      </button>

      <button onclick="startExerciseWithCheck('speaking', 'speaking.html')">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/52.png" alt="Meowth">
        Speaking - N√≥i
      </button>

      <button onclick="startExerciseWithCheck('overview', 'overview.html')">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/137.png" alt="Porygon">
        Writing - Vi·∫øt
      </button>

      <button onclick="startExerciseWithCheck('communication1', 'communication1.html')">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/100.png" alt="Voltorb">
        Communication - Giao ti·∫øp
      </button>

      <button onclick="startExerciseWithCheck('phonics', 'phonics.html')">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/146.png" alt="Moltres">
        Phonics - Ph√°t √¢m
      </button>


      <div style="font-weight:bold; font-size:18px; color:#ffeb3b; text-shadow:1px 1px 2px #000; text-align:left;">
        üìå PH·∫¶N D√ÄNH CHO C·∫§P HAI
      </div>

      <button onclick="startExercise('bai-tap-cap-2.html')">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/375.png" alt="Metang">
        Secondary - B√†i T·∫≠p C·∫•p 2
      </button>

      <div style="font-weight:bold; font-size:18px; color:#ffeb3b; text-shadow:1px 1px 2px #000; text-align:left;">
        üìå PH·∫¶N PH·ª§ TR·ª¢ H·ªåC SINH
      </div>

        <button onclick="startExercise('summary.html')">
          <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/249.png" alt="Lugia">
          Result - K·∫øt qu·∫£ - H·ªçc sinh ·∫•n v√†o ƒë√¢y sau khi h·ªçc h·∫øt
        </button>

        <button onclick="startExercise('collection.html')">
          <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/300.png" alt="Dragonite">
          B·ªô s∆∞u t·∫≠p Pokemon - v√†o m·ªói ng√†y
        </button>
       

      <button onclick="startExercise('fight.html')">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/348.png" alt="Dragonite">
        Fight - B·∫Øt c·∫∑p chi·∫øn ƒë·∫•u
      </button>

      <button onclick="startExercise('story.html')">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/122.png" alt="Dragonite">
        Story- ƒê·ªçc truy·ªán
      </button>
      
      <button onclick="startExercise('document.html')">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/349.png" alt="Dragonite">
        T√†i li·ªáu h·ªçc - n√™n xem tr∆∞·ªõc khi h·ªçc
      </button>

      <button onclick="startExercise('vocabulary-checking.html')">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/144.png" alt="Dragonite">
        Ki·ªÉm tra t·ª´ v·ª±ng
      </button>

      <button onclick="startExercise('shadow.html')">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/344.png" alt="Dragonite">
        Luy·ªán ng·ªØ ƒëi·ªáu Shadowing
      </button>
      

      <button onclick="startExercise('parents.html')">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/48.png" alt="Dragonite">
        d√†nh cho ph·ª• huynh
      </button>
      
    <div style="font-weight:bold; font-size:18px; color:#ffeb3b; text-shadow:1px 1px 2px #000; text-align:left;">
        üìå PH·∫¶N D√ÄNH CHO TH·∫¶Y
    </div>
      <button onclick="startExercise('student-login.html')">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/149.png" alt="Dragonite">
        t·ªïng h·ª£p h·ªçc sinh- d√†nh cho th·∫ßy
      </button>

  

        
      
      
    </div>
  </div>

  <script>
    const words = JSON.parse(localStorage.getItem("wordBank")) || [];
    document.getElementById("wordList").textContent = words.join(", ");

    function startExercise(page) {
      window.location.href = `exercises/${page}`;
    }

    function startExerciseWithCheck(partName, page) {
      const currentWords = JSON.parse(localStorage.getItem("wordBank")) || [];
      const key = "checked:" + partName + ":" + currentWords.join(",");
      const checked = localStorage.getItem(key);
      if (checked === "true") {
        startExercise(page);
      } else {
        showPrecheck(partName, page, key);
      }
    }

    function showPrecheck(partName, page, key) {
      document.getElementById("precheckOverlay").style.display = "flex";
      loadPrecheck(partName, page, key);
    }

    async function loadPrecheck(partName, page, key) {
      const SHEET_URL = "https://docs.google.com/spreadsheets/d/1KaYYyvkjFxVVobRHNs9tDxW7S79-c5Q4mWEKch6oqks/gviz/tq?tqx=out:json";
      const wordBank = JSON.parse(localStorage.getItem("wordBank")) || [];
      const checkedWords = JSON.parse(localStorage.getItem("checkedWords") || "[]");

      const res = await fetch(SHEET_URL);
      const txt = await res.text();
      const json = JSON.parse(txt.substring(47).slice(0, -2));
      const rows = json.table.rows;

      const vocabList = rows.map(row => ({
        word: row.c[2]?.v?.trim() || "",
        meaning: row.c[24]?.v?.trim() || ""
      })).filter(item => wordBank.includes(item.word));

      const remaining = vocabList.filter(item => !checkedWords.includes(item.word));
      const current = remaining.length > 0
        ? remaining[Math.floor(Math.random() * remaining.length)]
        : vocabList[Math.floor(Math.random() * vocabList.length)];

      if (remaining.length === 0) localStorage.setItem("checkedWords", "[]");

      const wrongChoices = vocabList.filter(w => w.word !== current.word).map(w => w.meaning);
      const options = [current.meaning, ...wrongChoices.slice(0, 3)].sort(() => Math.random() - 0.5);

      document.getElementById("questionWord").textContent = `üî§ T·ª´: ${current.word}`;
      // üîä ƒê·ªçc to t·ª´ ti·∫øng Anh
      const utter = new SpeechSynthesisUtterance(current.word);
      utter.lang = "en-US";
      utter.rate = 0.9;
      speechSynthesis.speak(utter);

      
      const choicesArea = document.getElementById("choicesArea");
      choicesArea.innerHTML = "";

      const row1 = document.createElement("div");
      const row2 = document.createElement("div");
      row1.style.display = "flex";
      row2.style.display = "flex";
      row1.style.justifyContent = "center";
      row2.style.justifyContent = "center";
      row1.style.gap = "12px";
      row2.style.gap = "12px";
      row1.style.marginBottom = "12px";

      options.forEach((opt, i) => {
        const btn = document.createElement("button");
        btn.textContent = `${String.fromCharCode(65 + i)}. ${opt}`;
        btn.style.padding = "16px 24px";
        btn.style.fontSize = "20px";
        btn.style.borderRadius = "12px";
        btn.style.minWidth = "120px";
        btn.style.cursor = "pointer";
        btn.style.background = "#fff";
        btn.style.color = "#000";
        btn.style.border = "2px solid #ccc";
        btn.onclick = () => handlePrecheckAnswer(opt, current.meaning, current.word, key);

        if (i < 2) {
          row1.appendChild(btn);
        } else {
          row2.appendChild(btn);
        }
      });

      choicesArea.appendChild(row1);
      choicesArea.appendChild(row2);


      document.getElementById("precheckStatus").textContent = "";
    }

    function handlePrecheckAnswer(selected, correct, word, key) {
      const status = document.getElementById("precheckStatus");
      
      if (selected === correct) {
        // üîä ƒê·ªçc t·ª´ v·ª±ng khi tr·∫£ l·ªùi ƒë√∫ng
        speechSynthesis.cancel();
        const utter = new SpeechSynthesisUtterance(word);
        utter.lang = "en-US";
        utter.rate = 0.9;
        speechSynthesis.speak(utter);

        const checkedWords = JSON.parse(localStorage.getItem("checkedWords") || "[]");
        if (!checkedWords.includes(word)) {
          checkedWords.push(word);
          localStorage.setItem("checkedWords", JSON.stringify(checkedWords));
        }
        localStorage.setItem(key, "true");
        status.textContent = "‚úÖ Ch√≠nh x√°c! B·∫°n c√≥ th·ªÉ v√†o nhi·ªám v·ª•.";
        setTimeout(() => {
          document.getElementById("precheckOverlay").style.display = "none";
        }, 1200);
      } else {
        status.textContent = "‚ùå Sai r·ªìi! Th·ª≠ l·∫°i c√¢u n√†y.";
      }

    }
  </script>


  

  
</body>
</html>

<!-- ... to√†n b·ªô ph·∫ßn HTML g·ªëc c·ªßa Anh gi·ªØ nguy√™n nh∆∞ ƒë√£ g·ª≠i ... -->

<!-- TH√äM KHUNG KI·ªÇM TRA -->
<div id="precheckOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:999; justify-content:center; align-items:center;">
  <div id="precheckBox" style="background:#fff; color:#000; padding:30px; border-radius:16px; max-width:480px; box-shadow:0 0 20px rgba(0,0,0,0.5); text-align:center;">
    <h2>üß† MINI TEST</h2>
    <p id="questionWord" style="font-size:22px;">ƒêang t·∫£i...</p>
    <div id="choicesArea"></div>
    <div id="precheckStatus" style="margin-top:16px; font-weight:bold;"></div>
  </div>
</div>
